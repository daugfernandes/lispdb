\documentclass[a4,11pt]{article}
\usepackage{graphicx}
\usepackage{color}
\usepackage{anysize}
\usepackage{multicol}
\usepackage{textcomp}
\usepackage[portuguese]{babel}

\marginsize{3cm}{3cm}{1cm}{3cm}
\setlength{\columnsep}{0.8cm}

\title{Um parser XML\footnote{Extensible Markup Language - http://www.w3.org/standards/xml/core} em Common Lisp}
\author{David Fernandes\\
\texttt{daugfernandes@aim.com}}
\date{\today}

\begin{document}

\maketitle

\begin{abstract}

\begin{multicols}{2}

Com o advento da Internet e com o consequente aumento, por um lado, do mercado potencial consumidor de informa\c{c}\~{a}o e, por outro, da facilidade de acesso a fontes de dados diversas, operou-se uma mudan\c{c}a significativa de paradigma no que toca ao desenvolvimento de aplica\c{c}\~{o}es: a produ\c{c}\~{a}o e a utiliza\c{c}\~{a}o da informa\c{c}\~{a}o tornaram-se actividades aut\'{o}nomas, cada uma delas objecto de neg\'{o}cio por si mesma, cada uma delas objecto de investiga\c{c}\~{a}p e desenvolvimento aut\'{o}nomos.

Deste modo, as aplica\c{c}\~{o}es consumidoras de dados necessitam de um mecanismo que lhes permita aceder de forma controlada ao conte\'{u}do estruturado de um bloco de informa\c{c}\~{a}o representada em XML.

Este trabalho apresenta o desenvolvimento e implementa\c{c}\~{a}o de um tal mecanismo, chamado de 'parser', em Common Lisp.

\end{multicols}

\end{abstract}

\section{Introdu\c{c}\~{a}o}

\subsection{Perspectiva hist\'{o}rica\cite{W3C06}}

A XML \'{e} uma linguagem de 'marcas', de certa forma descendente da GML criada pela IBM, que permite descrever de forma estruturada os mais variados tipos de informa\c{c}\~{a}o.

\section{XML}

Apresentaremos de seguida a gram\'{a}tica independente de contexto formal da XML tal como definida pelo W3C, tendo o cuidado de colocar ap\'{o}s cada grupo de produ\c{c}\~{o}es um exemplo XML concreto da utiliza\c{c}\~{a}o das mesmas.

\subsection{Gram\'{a}tica da XML}

\subsubsection{Documento}
Um documento XML consiste no pr\'{o}logo e no elemento ra\'{i}z. (Ver exemplo em \ref{Document})
\vspace{0.5cm}
\\\begin{tabular}{p{1cm} p{3cm} c l}
1&document&::=&( \#prolog element Misc* ) - ( Char* RestrictedChar Char* )\\
\end{tabular}

\subsubsection{Car\'{a}cteres}

\begin{tabular}{p{1cm} p{3cm} c l}
2&Char&::=&[\#x1-\#xD7FF]\\
&&&\space\textbar\space[\#xE000-\#xFFFD]\\
&&&\space\textbar\space[\#x10000-\#x10FFFF]\\
&&&\\
2a&RestrictedChar&::=&[\#x1-\#x8]\\
&&&\space\textbar\space[\#xB-\#xC]\\
&&&\space\textbar\space[\#xE-\#x1F]\\
&&&\space\textbar\space[\#x7F-\#x84]\\
&&&\space\textbar\space[\#x86-\#x9F]
\end{tabular}

\subsubsection{Espa\c{c}o em branco}

\begin{tabular}{p{1cm} p{3cm} c l}
3&S&::=&(\#x20\space\textbar\space\#x9\space\textbar\space\#xD\space\textbar\space\#xA)+ 
\end{tabular}

\subsubsection{Nomes e 'tokens'}

\begin{tabular}{p{1cm} p{3cm} c l}
4&NameStartChar&::=&\textquotedblleft:\textquotedblright\space\textbar\space[A-Z]\space\textbar\space''\_''\space\textbar\space[a-z]\\
&&&\space\textbar\space[\#xC0-\#xD6]\space\textbar\space[\#xD8-\#xF6]\space\textbar\space[\#xF8-\#x2FF]\\
&&&\space\textbar\space[\#x370-\#x37D]\space\textbar\space[\#x37F-\#x1FFF]\space\textbar\space\#x200C-\#x200D]\\
&&&\space\textbar\space[\#x2070-\#x218F]\space\textbar\space[\#x2C00-\#x2FEF]\space\textbar\space[\#x3001-\#xD7FF]\\
&&&\space\textbar\space[\#xF900-\#xFDCF]\space\textbar\space[\#xFDF0-\#xFFFD]\space\textbar\space[\#x10000-\#xEFFFF]\\
&&&\\
4a&NameChar&::=&NameStartChar\space\textbar\space''-''\space\textbar\space''.''\\
&&&\space\textbar\space[0-9]\space\textbar\space\#xB7\\
&&&\space\textbar\space[\#x0300-\#x036F]\space\textbar\space[\#x203F-\#x2040]\\
&&&\\
5&Name&::=&NameStartChar (NameChar)*\\
&&&\\
6&Names&::=&Name (\#x20 Name)*\\
&&&\\
7&Nmtoken&::=&(NameChar)+\\
&&&\\
8&Nmtokens&::=&Nmtoken (\#x20 Nmtoken)*
\end{tabular}

\subsubsection{Literais}

\begin{tabular}{p{1cm} p{3cm} c l}
9&EntityValue&::=&'' ([\^{}\%\&''] \space\textbar\space PEReference \space\textbar\space Reference)* ''\\
&&&\space\textbar\space'([\^{}\%\&'] \space\textbar\space PEReference \space\textbar\space Reference)* '\\
&&&\\
10&AttValue&::=&'' ([\^{}\textless\&''] \space\textbar\space Reference)* ''\\
&&&\space\textbar\space' ([\^{}\textless\&'] \space\textbar\space Reference)* '\\
&&&\\
11&SystemLiteral&::=&('' [\^{}'']* '') \space\textbar\space (' [\^']* ')\\
&&&\\
12&PubidLiteral&::=&'' PubidChar* '' \space\textbar\space ' (PubidChar - ')* '\\
&&&\\
13&PubidChar&::=&\#x20\space\textbar\space\#xD\space\textbar\space\#xA\space\textbar\space[a-zA-Z0-9]\space\textbar\space[-'()+,./:=?;!*\#\@\$\_\%]
\end{tabular}

\subsubsection{Dados car\'{a}cter}

\begin{tabular}{p{1cm} p{3cm} c l}
14&CharData&::=&[\^{}\textless\&]* - ([\^{}\textless\&]* ']]\textgreater' [\^{}\textless\&]*)
\end{tabular}

\subsubsection{Coment\'{a}rios}

\begin{tabular}{p{1cm} p{3cm} c l}
15&Comment&::=&'\textless!--' ((Char - '-')\space\textbar\space ('-' (Char - '-')))* '--\textgreater'
\end{tabular}

\subsubsection{Instru\c{c}\~{o}es de processamento}

\begin{tabular}{p{1cm} p{3cm} c l}
16&PI&::=&'\textless?' PITarget (S (Char* - (Char* '?\textgreater' Char*)))? '?\textgreater'\\
&&&\\
17&PITarget&::=&Name - (('X'\space\textbar\space 'x') ('M'\space\textbar\space'm') ('L'\space\textbar\space'l'))
\end{tabular}

\subsubsection{Sec\c{c}\~{o}es CDATA}
\begin{tabular}{p{1cm} p{3cm} c l}
18&CDSect&::=&CDStart CData CDEnd\\
&&&\\
19&CDStart&::=&'\textless![CDATA['\\
&&&\\
20&CData&::=&(Char* - (Char* ']]\textgreater' Char*))\\
&&&\\
21&CDEnd&::=&']]\textgreater'
\end{tabular}

\subsubsection{Prolog}
\begin{tabular}{p{1cm} p{3cm} c l}
22&prolog&::=&XMLDecl Misc* (doctypedecl Misc*)?\\
&&&\\
23&XMLDecl&::=&'\textless?xml' VersionInfo EncodingDecl? SDDecl? S? '?\textgreater'\\
&&&\\
24&VersionInfo&::=&S 'version' Eq ("'" VersionNum "'"\space\textbar\space '"' VersionNum '"')\\
&&&\\
25&Eq&::=&S? '=' S?\\
&&&\\
26&VersionNum&::=&'1.1'\\
&&&\\
27&Misc&::=&Comment\space\textbar\space PI\space\textbar\space S
\end{tabular}

\subsubsection{Defini\c{c}\~{a}o DOCTYPE}
\begin{tabular}{p{1cm} p{3cm} c l}
28&doctypedecl&::=&'\textless!DOCTYPE' S Name (S ExternalID)? S? ('[' intSubset ']' S?)? '\textgreater'\\
&&&\\
28a&DeclSep&::=&PEReference\space\textbar\space S\\
&&&\\
28b&intSubset&::=&(markupdecl\space\textbar\space DeclSep)*\\
&&&\\
29&markupdecl&::=&elementdecl\space\textbar\space AttlistDecl\space\textbar\space EntityDecl\space\textbar\space NotationDecl\space\textbar\space PI\space\textbar\space Comment
\end{tabular}

\subsubsection{Subconjuntos externos}
\begin{tabular}{p{1cm} p{3cm} c l}
30&extSubset&::=&TextDecl? extSubsetDecl\\
&&&\\
31&extSubsetDecl&::=&( markupdecl\space\textbar\space conditionalSect\space\textbar\space DeclSep)*
\end{tabular}

\subsubsection{Declara\c{c}\~{a}o de documento isolado}
\begin{tabular}{p{1cm} p{3cm} c l}
32&SDDecl&::=&S 'standalone' Eq ((\textquotedblright\textquotesingle\textquotedblright (\textquotesingle yes\textquotesingle \space\textbar\space \textquotesingle no\textquotesingle) \textquotedblright\textquotesingle\textquotedblright) \space\textbar\space (\textquoteright \textquotestraightdblbase\textquoteright (\textquotesingle yes\textquotesingle \space\textbar\space \textquotesingle no\textquotesingle ) \textquoteright\textquotestraightdblbase\textquoteright))
\end{tabular}

\subsubsection{Elemento}
\begin{tabular}{p{1cm} p{3cm} c l}
39&element&::=&EmptyElemTag\space\textbar\space STag content ETag
\end{tabular}

\subsubsection{TAG de in\'{i}cio}
\begin{tabular}{p{1cm} p{3cm} c l}
40&STag&::=&'\textless' Name (S Attribute)* S? '\textgreater'\\
&&&\\
41&Attribute&::=&Name Eq AttValue
\end{tabular}

\subsubsection{TAG de fim}
\begin{tabular}{p{1cm} p{3cm} c l}
42&ETag&::=&'\textless/' Name S? '\textgreater'
\end{tabular}

\subsubsection{Conte\'u{u}do de um elemento}
\begin{tabular}{p{1cm} p{3cm} c l}
43&content&::=&CharData? ((element\space\textbar\space Reference\space\textbar\space CDSect\\
&&&\space\textbar\space PI\space\textbar\space Comment) CharData?)*
\end{tabular}

\subsubsection{TAG de elementos vazios}
\begin{tabular}{p{1cm} p{3cm} c l}
44&EmptyElemTag&::=&'\textless' Name (S Attribute)* S? '/\textgreater'
\end{tabular}

\subsubsection{Declara\c{c}\~{a} de tipo de elemento}
\begin{tabular}{p{1cm} p{3cm} c l}
45&elementdecl&::=&'\textless!ELEMENT' S Name S contentspec S? '\textgreater'\\
&&&\\
46&contentspec&::=&'EMPTY'\space\textbar\space 'ANY'\space\textbar\space Mixed\space\textbar\space children
\end{tabular}

\subsubsection{Modelos de conte\'{u}do de elemento}
\begin{tabular}{p{1cm} p{3cm} c l}
47&children&::=&(choice\space\textbar\space seq) ('?'\space\textbar\space '*'\space\textbar\space '+')?\\
&&&\\
48&cp&::=&(Name\space\textbar\space choice\space\textbar\space seq) ('?'\space\textbar\space '*'\space\textbar\space '+')?\\
&&&\\
49&choice&::=&'(' S? cp ( S? '\textbar' S? cp )+ S? ')'\\
&&&\\
50&seq&::=&'(' S? cp ( S? ',' S? cp )* S? ')'
\end{tabular}

\subsubsection{Declara\c{c}\~{a}o de conte\'{u}do mist0}
\begin{tabular}{p{1cm} p{3cm} c l}
51&Mixed&::=&'(' S? '\#PCDATA' (S? '\textbar' S? Name)* S? ')*'\space\textbar\space '(' S? '\#PCDATA' S? ')'
\end{tabular}

\subsubsection{Declara\c{c}\~{a}o de lista de atributos}
\begin{tabular}{p{1cm} p{3cm} c l}
52&AttlistDecl&::=&'\textless!ATTLIST' S Name AttDef* S? '\textgreater'\\
&&&\\
53&AttDef&::=&S Name S AttType S DefaultDecl\\
&&&\\
54&AttType&::=&StringType\space\textbar\space TokenizedType\space\textbar\space EnumeratedType\\
&&&\\
55&StringType&::=&'CDATA'\\
&&&\\
56&TokenizedType&::=&'ID'\space\textbar\space 'IDREF'\space\textbar\space'IDREFS'\\
&&&\space\textbar\space'ENTITY'\space\textbar\space 'ENTITIES'\\
&&&\space\textbar\space 'NMTOKEN'\space\textbar\space 'NMTOKENS'
\end{tabular}

\subsubsection{Tipos de atributos enumerados}
\begin{tabular}{p{1cm} p{3cm} c l}
57&EnumeratedType&::=&NotationType\space\textbar\space Enumeration\\
&&&\\
58&NotationType&::=&'NOTATION' S '(' S? Name (S? '\textbar' S? Name)* S? ')'\\
&&&\\
59&Enumeration&::=&'(' S? Nmtoken (S? '\textbar' S? Nmtoken)* S? ')'	
\end{tabular}

\subsubsection{Valores de atributos por omiss\~{a}o}
\begin{tabular}{p{1cm} p{3cm} c l}
60&DefaultDecl&::=&'\#REQUIRED'\space\textbar\space '\#IMPLIED'\space\textbar\space (('\#FIXED' S)? AttValue)
\end{tabular}

\subsubsection{Sec\c{c}\~{a}o condicional}
\begin{tabular}{p{1cm} p{3cm} c l}
61&conditionalSect&::=&includeSect\space\textbar\space ignoreSect\\
&&&\\
62&includeSect&::=&'\textless![' S? 'INCLUDE' S? '[' extSubsetDecl ']]\textgreater'\\
&&&\\
63&ignoreSect&::=&'\textless![' S? 'IGNORE' S? '[' ignoreSectContents* ']]\textgreater'\\
&&&\\
64&ignoreSectContents&::=&Ignore ('\textless![' ignoreSectContents ']]\textgreater' Ignore)*\\
&&&\\
65&Ignore&::=&Char* - (Char* ('\textless!['\space\textbar\space ']]\textgreater') Char*)
\end{tabular}

\subsubsection{Car\'{a}cter}
\begin{tabular}{p{1cm} p{3cm} c l}
66&CharRef&::=&'\&\#' [0-9]+ ';'\space\textbar\space '\&\#x' [0-9a-fA-F]+ ';'
\end{tabular}

\subsubsection{Entidade}
\begin{tabular}{p{1cm} p{3cm} c l}
67&Reference&::=&EntityRef\space\textbar\space CharRef\\
&&&\\
68&EntityRef&::=&'\&' Name ';'\\
&&&\\
69&PEReference&::=&'\%' Name ';'
\end{tabular}

\subsubsection{Declara\c{c}\~{a}o de entidade}
\begin{tabular}{p{1cm} p{3cm} c l}
70&EntityDecl&::=&GEDecl\space\textbar\space PEDecl\\
&&&\\
71&GEDecl&::=&'\textless!ENTITY' S Name S EntityDef S? '\textgreater'\\
&&&\\
72&PEDecl&::=&'\textless!ENTITY' S '\%' S Name S PEDef S? '\textgreater'\\
&&&\\
73&EntityDef&::=&EntityValue\space\textbar\space (ExternalID NDataDecl?)\\
&&&\\
74&PEDef&::=&EntityValue\space\textbar\space ExternalID
\end{tabular}

\subsubsection{Declara\c{c}\~{a}o de entidade externa}
\begin{tabular}{p{1cm} p{3cm} c l}
75&ExternalID&::=&'SYSTEM' S SystemLiteral\space\textbar\space 'PUBLIC' S PubidLiteral S SystemLiteral\\
&&&\\
76&NDataDecl&::=&S 'NDATA' S Name	
\end{tabular}

\subsubsection{Declara\c{c}\~{a}o de texto}
\begin{tabular}{p{1cm} p{3cm} c l}
77&TextDecl&::=&'\textless?xml' VersionInfo? EncodingDecl S? '?\textgreater'
\end{tabular}

\subsubsection{Entidade externa bem-formada}
\begin{tabular}{p{1cm} p{3cm} c l}
78&extParsedEnt&::=&( TextDecl? content ) - ( Char* RestrictedChar Char* )
\end{tabular}

\subsubsection{Declara\c{c}\~{a}o de codifica\c{c}\~{a}o}
\begin{tabular}{p{1cm} p{3cm} c l}
80&EncodingDecl&::=&S 'encoding' Eq ('"' EncName '"'\space\textbar\space "'" EncName "'" )\\
&&&\\
81&EncName&::=&[A-Za-z] ([A-Za-z0-9.\_]\space\textbar\space '-')*
\end{tabular}

\subsubsection{Declara\c{c}\~{a}o de nota\c{c}\~{a}o}
\begin{tabular}{p{1cm} p{3cm} c l}
82&NotationDecl&::=&'\textless!NOTATION' S Name S (ExternalID\space\textbar\space PublicID) S? '\textgreater'\\
&&&\\
83&PublicID&::=&'PUBLIC' S PubidLiteral
\end{tabular}

\pagebreak 

\section{Exemplos}

\subsection{Documento}\label{Document} 
\begin{figure}[h]
\begin{verbatim}
<?xml version="1.0"?>
<mensagem>
  <enviada timezone="UTC">12:54</enviada>
  <de>
    <nome>David Fernandes</nome>
    <endereco>daugfernandes@aim.com</endereco>
  </de>
  <para>
    <endereco>lc@univ-ab.pt</endereco>
  </para>
  <corpo>
    Gostaria de marcar encontro para apresentação de 
    ideia para projecto de final de curso.
  </corpo>
</mensagem>
\end{verbatim}
\caption{Document}
\end{figure}

\pagebreak

\begin{thebibliography}{9}
\bibitem{BRAY06}Bray, T., Paoli, J., Sperberg-McQueen, C. M., Maler, E., Yergeau, F., Cowan, J. (Eds.). (2006).
 \emph{Extensible Markup Language (XML) 1.1 (Second Edition) -W3C Recommendation 16 August 2006, edited in place 29 September 2006}, [html] Acedido em 26 de Janeiro de 2011, no \emph{Web Site} do W3C: http://www.w3.org/TR/2006/REC-xml11-20060816/

\bibitem{W3C06}Connolly, R. (Rev.) (2006)
 \emph{Development History}, [html] Acedido em 26 de Janeiro de 2011, no \emph{Web Site} do W3C: http://www.w3.org/XML/hist2002

\end{thebibliography}

\end{document}
